---
const raw = Astro.url.pathname || '/';
const normalize = (p: string) => {
  if (!p) return '/';
  return p === '/' ? '/' : p.replace(/\/+$/, '');
};
const pathname = normalize(raw);
const active = (p: string) => (pathname === normalize(p) ? 'active' : '');

const titleMap: Record<string, string> = {
  '/': 'Home',
  '/about': 'About',
  '/resume': 'Resume',
  '/design': 'Design',
  '/contact': 'Contact',
};
const pageTitle = titleMap[pathname] ?? '';
---

<nav class="topbar" aria-label="Primary">
  <div class="row">
    <!-- Left: Logo -->
    <a href="/" class="logo-link" aria-label="Home">
      <img class="logo" src="/icons/logo dark.png" alt="Logo" />
    </a>

    <!-- Center spacer -->
    <div class="spacer" aria-hidden="true"></div>

    <!-- Right: Desktop menu -->
    <ul class="menu" role="menubar" aria-label="Main">
      <li role="none">
        <a role="menuitem" class={`link ${active('/about')}`} href="/about">About</a>
      </li>
      <li role="none">
        <a role="menuitem" class={`link link-outline ${active('/resume')}`} href="/resume">Resume</a>
      </li>
      <li role="none">
        <a role="menuitem" class={`link ${active('/design')}`} href="/design">Design</a>
      </li>
      <li role="none">
        <a role="menuitem" class={`link ${active('/contact')}`} href="/contact">Contact</a>
      </li>
    </ul>

    <!-- Right: Hamburger (mobile only) -->
    <button
      class="hamburger"
      id="mobileMenuBtn"
      aria-label="Open navigation menu"
      aria-haspopup="menu"
      aria-expanded="false"
      aria-controls="mobileMenu"
    >
      <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor" aria-hidden="true">
        <path d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"/>
      </svg>
    </button>
  </div>

  <!-- Mobile dropdown -->
  <div class="mobile-menu" id="mobileMenu" hidden>
    <ul class="mobile-list" role="menu" aria-label="Mobile">
      <li role="none"><a role="menuitem" class={`link ${active('/about')}`} href="/about">About</a></li>
      <li role="none"><a role="menuitem" class={`link ${active('/resume')}`} href="/resume">Resume</a></li>
      <li role="none"><a role="menuitem" class={`link ${active('/design')}`} href="/design">Design</a></li>
      <li role="none"><a role="menuitem" class={`link ${active('/contact')}`} href="/contact">Contact</a></li>
    </ul>
  </div>
</nav>

<script>
  (function(){
    const menuBtn = document.getElementById('mobileMenuBtn');
    const menu = document.getElementById('mobileMenu');

    function closeMenu(){
      if (!menu.hasAttribute('hidden')) {
        menu.setAttribute('hidden', '');
        menuBtn.setAttribute('aria-expanded', 'false');
      }
    }
    function openMenu(){
      menu.removeAttribute('hidden');
      menuBtn.setAttribute('aria-expanded', 'true');
    }

    menuBtn?.addEventListener('click', () => {
      const open = menuBtn.getAttribute('aria-expanded') === 'true';
      open ? closeMenu() : openMenu();
    });

    document.addEventListener('click', (e) => {
      if (!menu.contains(e.target) && !menuBtn.contains(e.target)) closeMenu();
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeMenu();
    });
    menu.querySelectorAll('a').forEach(a =>
      a.addEventListener('click', closeMenu)
    );
  })();
</script>

<style>
  :root{
    --pill-text:#e7e7e7;
  }

  .topbar{
    position: sticky;
    top: 0;
    z-index: 1000;

    width: 80%;
    margin: 2rem auto 0;
    background: var(--bg);
  }

  .row{
    max-width:1200px;
    margin:0 auto;
    padding:.6rem 0rem 1rem 1rem;
    display:grid;
    align-items:center;
    column-gap:1rem;
    grid-template-columns: auto 1fr auto;
    min-width:0;
  }

  .logo-link{ display:inline-flex; align-items:center; }
  .logo{ height:32px; width:auto; }

  .spacer{ min-width:0; }

  .menu{
    list-style:none;
    margin:0;
    padding:.2rem;
    display:flex;
    gap:1.25rem;
    justify-self:end;
    align-items:center;
  }

  .link{
    font-family:'Montserrat',system-ui,sans-serif;
    font-weight:600;
    color:var(--muted);
    text-decoration:none;
    transition:color .18s ease, border-color .18s ease;
    display:inline-flex;
    align-items:center;
  }

  .link:hover{ color:var(--text); }
  .link.active{
    font-weight:700;
    color:var(--text);
  }

  /* Resume outline â€” desktop only (rectangle) */
  @media (min-width: 769px){
    .link-outline{
      padding:.45rem .75rem;
      border:1px solid rgba(255,255,255,.9);
      border-radius:0px; /* rectangle (not pill) */
      line-height:1;
      color:var(--text);
    }
    .link-outline:hover{
      border-color: rgba(255,255,255,1);
    }
    .link-outline.active{
      border-color: rgba(255,255,255,1);
    }
  }

  /* Mobile: no outline */
  @media (max-width: 768px){
    .link-outline{
      padding:0;
      border:none;
      border-radius:0;
    }
  }

  .hamburger{
    appearance:none;
    background:none;
    border:none;
    padding:.35rem;
    cursor:pointer;
    color:var(--text);
    justify-self:end;
  }

  .page-title{
    display:none;
    font-weight:800;
    letter-spacing:-0.01em;
    overflow:hidden;
    white-space:nowrap;
    text-overflow:ellipsis;
    text-align:right;
  }

  .mobile-menu{
    position: relative;
  }

  .mobile-list{
    position:absolute;
    top:100%;
    right:1rem;
    margin:.25rem 0 0;
    padding:.5rem .6rem;
    list-style:none;
    background:var(--bg);
    border:1px solid var(--border);
    border-radius:12px;
    box-shadow:0 6px 18px rgba(0,0,0,.08);
    display:flex;
    flex-direction:column;
    gap:.75rem;

    /* key: only as wide as its contents */
    width: max-content;
    min-width: 0;
    align-items:flex-start;
  }

  @media (max-width:768px){
    .menu{ display:none; }
    .page-title{ display:block; }

    .row{
      grid-template-columns: auto 1fr auto;
      column-gap:.5rem;
    }
  }

  @media (min-width:769px){
    .mobile-menu,
    .hamburger,
    .page-title{ display:none; }
  }
</style>
